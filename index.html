<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рж░ржоржЬрж╛ржи рзирзжрзирзм тАФ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla&family=Inter:wght@400;700;800&family=Amiri&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #F0F9F4;
    --card-bg: #FFFFFF;
    --text-main: #1A2F23;
    --text-muted: #64748B;
    --accent-green: #10B981;
    --border: #E2E8F0;
    --sahur-grad: #DCFCE7;
    --iftar-grad: #E2F0D9;
    --status-bg: #064E3B;
  }
  body {
    font-family: 'Tiro Bangla', serif;
    background-color: var(--bg);
    color: var(--text-main);
    min-height: 100vh;
    padding-bottom: 110px;
    -webkit-font-smoothing: antialiased;
  }
  .en-font { font-family: 'Inter', sans-serif; letter-spacing: -0.02em; }
  .ar-font { font-family: 'Amiri', serif; direction: rtl; unicode-bidi: isolate; font-size: 1.5rem; line-height: 1.8; color: #064E3B; margin-bottom: 10px; display: block; text-align: right; }
  .onubad { font-size: 15px; color: #1E293B; font-weight: 500; margin-bottom: 8px; line-height: 1.5; }
  .source { font-size: 12px; color: var(--accent-green); font-weight: 700; opacity: 0.8; }

  #loader { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 2000; font-weight: bold; font-size: 1.2rem; }
  .spinner { width: 40px; height: 40px; border: 4px solid #ddd; border-top: 4px solid var(--accent-green); border-radius: 50%; animation: spin 0.8s linear infinite; }

  #splash { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 1500; padding: 20px; }
  .splash-card { background: var(--card-bg); border-radius: 28px; padding: 25px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); text-align: center; }
  .zila-list { max-height: 300px; overflow-y: auto; border: 1px solid var(--border); border-radius: 12px; margin-top: 15px; text-align: left; }
  .zila-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f9f9f9; font-weight: 600; font-size: 15px; }
  .zila-item:hover { background: var(--bg); color: var(--accent-green); }

  #app { display: none; max-width: 1100px; margin: 0 auto; padding: 15px; }

  .status-card { background: var(--status-bg); border-radius: 16px; padding: 10px 12px; margin-bottom: 15px; color: white; display: flex; align-items: center; justify-content: space-between; gap: 8px; box-shadow: 0 4px 20px rgba(6, 78, 59, 0.1); }
  .status-left { flex: 1.5; display: flex; flex-direction: column; }
  .status-left .hijri { font-size: 12px; font-weight: 800; color: #10B981; }
  .status-left .count { font-size: 10px; opacity: 0.9; font-weight: 700; }
  .status-mid { flex: 1; text-align: center; font-size: 13px; font-weight: 800; border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1); padding: 0 5px; }
  .status-right { flex: 1.5; display: flex; align-items: center; justify-content: flex-end; gap: 6px; }
  .city-box { text-align: right; line-height: 1.1; cursor: pointer; }
  .city-box .city { font-size: 12px; font-weight: 800; display: block; }
  .city-box .change { font-size: 8px; color: #10B981; text-decoration: underline; font-weight: 700; }
  .status-badge { background: #10B981; min-width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; color: #064E3B; }

  .hero-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
  .hero-card { border-radius: 18px; padding: 15px; height: 140px; display: flex; flex-direction: column; justify-content: space-between; border: 2px solid transparent; }
  .card-sahur { background: var(--sahur-grad); }
  .card-iftar { background: var(--iftar-grad); }
  .hero-card label { font-size: 12px; color: #334155; font-weight: 600; }
  .hero-card .event { font-size: 16px; font-weight: 800; color: #064E3B; }
  .hero-card .time { font-size: 22px; font-weight: 800; font-family: 'Inter', sans-serif; color: #0F172A; }
  .hero-card .sub { font-size: 10px; color: #475569; font-weight: 600; }

  .summary-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
  .summary-box { background: white; border-radius: 14px; padding: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.02); }
  .summary-label { font-size: 10px; color: var(--text-muted); font-weight: 700; margin-bottom: 2px; }
  .summary-time { font-size: 14px; font-weight: 800; font-family: 'Inter', sans-serif; color: #064E3B; }

  .floating-nav { display: flex; background: #E2E8F0; padding: 6px; border-radius: 20px; gap: 5px; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 1000; backdrop-filter: blur(15px); }
  .nav-btn { flex: 1; border: none; padding: 12px 5px; border-radius: 15px; font-family: 'Tiro Bangla', serif; font-size: 13px; font-weight: 700; cursor: pointer; background: transparent; color: #475569; transition: all 0.3s; }
  .nav-btn.active { background: white; color: var(--accent-green); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

  .table-wrapper { background: white; border-radius: 16px; overflow-x: auto; border: 1px solid var(--border); }
  table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 320px; }
  th { background: #F0FDF4; padding: 10px; text-align: left; color: #064E3B; font-weight: 800; }
  td { padding: 10px; border-bottom: 1px solid #F1F5F9; font-weight: 500; }
  tr.today-row { background: #F0FDF4; border-left: 5px solid var(--accent-green); }

  .dua-card { background: white; border-radius: 16px; padding: 18px; margin-bottom: 12px; border: 1px solid var(--border); }
  .dua-title { font-size: 15px; font-weight: 800; color: #065F46; margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 6px; }

  .salat-list { display: flex; flex-direction: column; gap: 8px; }
  .salat-item { display: flex; align-items: center; justify-content: space-between; background: #F8FAFC; padding: 12px 16px; border-radius: 12px; cursor: pointer; }
  .salat-item.completed { background: #DCFCE7; }
  .salat-check { width: 20px; height: 20px; border-radius: 6px; border: 2px solid #CBD5E1; display: flex; align-items: center; justify-content: center; background: white; }
  .completed .salat-check { background: #10B981; border-color: #10B981; }
  .salat-check svg { display: none; width: 12px; height: 12px; color: white; }
  .completed .salat-check svg { display: block; }
  .progress-container { background: #E2E8F0; border-radius: 6px; height: 6px; width: 100%; margin-bottom: 10px; overflow: hidden; }
  .progress-bar { background: #10B981; height: 100%; width: 0%; transition: width 0.4s ease; }
  .salat-reminder { background: #F0FDF4; color: #047857; padding: 8px; border-radius: 8px; font-size: 11px; font-weight: 700; margin-bottom: 10px; border: 1px solid #BBF7D0; text-align: center; }
  
  #reward-card { background: linear-gradient(135deg, #059669 0%, #064E3B 100%); color: white; display: none; padding: 15px; border-radius: 16px; text-align: center; margin-bottom: 10px; animation: bounceIn 0.8s; }
  .reset-btn { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; cursor: pointer; margin-top: 10px; }

  .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
  .modal-overlay.active { opacity: 1; visibility: visible; }
  .modal-content { background: white; width: 100%; max-width: 420px; border-radius: 20px; padding: 25px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2); text-align: center; }
  .modal-title { font-size: 18px; font-weight: 800; color: #064E3B; margin-bottom: 15px; }
  .modal-body { text-align: left; margin-bottom: 20px; font-size: 14px; color: #475569; }
  .update-item { display: flex; gap: 8px; margin-bottom: 8px; line-height: 1.4; }
  .update-item span { color: #10B981; font-weight: bold; }
  .btn-primary { background: #064E3B; color: white; border: none; padding: 12px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; width: 100%; }

  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
  footer { text-align: center; padding: 20px; font-size: 12px; border-top: 1px solid var(--border); margin-top: 20px; color: #64748B; }

  @media (min-width: 992px) { .layout-grid { grid-template-columns: 1fr 1fr; } }
</style>
</head>
<body>

<div id="loader">
  <div class="spinner"></div>
  рж╕ржорзЯрж╕рзВржЪрзА рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...
</div>

<div id="splash" style="display:none;">
  <div class="splash-card">
    <h1 class="splash-title" style="color: #064E3B; margin-bottom: 15px; font-size: 18px;">рж░ржоржЬрж╛ржи ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░ рзирзжрзирзм</h1>
    <input type="text" id="zila-search" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; outline:none;" placeholder="ржЬрзЗрж▓рж╛ ржЦрзБржБржЬрзБржи (Bangla or English)...">
    <div id="zila-list" class="zila-list"></div>
  </div>
</div>

<div id="app">
  <div class="status-card">
    <div class="status-left">
      <div class="hijri" id="hijri-display">--- Ramadan ---- AH</div>
      <div class="count" id="fast-count">рж░рзЛржЬрж╛ --/рзйрзж</div>
    </div>
    <div class="status-mid" id="fast-status">рж░рзЛржЬрж╛ ржЪрж▓ржЫрзЗ</div>
    <div class="status-right">
      <div class="city-box" id="change-city-btn">
        <span class="city" id="city-name">ржврж╛ржХрж╛</span>
        <span class="change">ржкрж░рж┐ржмрж░рзНрждржи</span>
      </div>
      <div class="status-badge" id="fast-num">--</div>
    </div>
  </div>

  <div class="layout-grid">
    <div id="main-view-col">
      <div class="hero-container">
        <div class="hero-card card-sahur" id="card-timer">
          <div><label>ржПржЦржи рж╕ржорзЯ</label><div class="event" id="timer-label">рж╕рж╛рж╣рж░рж┐ ржмрж╛ржХрж┐</div></div>
          <div class="time en-font" id="countdown-timer">рзжрзж:рзжрзж:рзжрзж</div>
          <div class="sub" id="duration-text">рж╕рж╛рж╣рж░рж┐рж░ рж╢рзЗрж╖ рж╕ржорзЯ</div>
        </div>
        <div class="hero-card card-iftar" id="card-next">
          <div><label>ржкрж░ржмрж░рзНрждрзА ржЗржнрзЗржирзНржЯ</label><div class="event" id="next-event-label">ржЗржлрждрж╛рж░ рж╢рзБрж░рзБ</div></div>
          <div class="time en-font" id="next-event-time">--:--</div>
          <div class="sub" id="sunset-text">ржЗржлрждрж╛рж░рзЗрж░ рж╕ржорзЯ</div>
        </div>
      </div>
      <div class="summary-container">
        <div class="summary-box">
          <div class="summary-label">рж╕рж╛рж╣рж░рж┐ рж╢рзЗрж╖</div>
          <div class="summary-time en-font" id="summ-sahur">--:--</div>
        </div>
        <div class="summary-box">
          <div class="summary-label">ржЗржлрждрж╛рж░ рж╢рзБрж░рзБ</div>
          <div class="summary-time en-font" id="summ-iftar">--:--</div>
        </div>
      </div>
    </div>

    <div>
      <div id="view-hadith">
        <div class="dua-card">
          <div class="dua-title">ЁЯУЦ ржЖржЬржХрзЗрж░ рж╣рж╛ржжрж┐рж╕</div>
          <div class="ar-font" id="hadith-ar"></div>
          <div class="onubad" id="hadith-bn"></div>
          <div class="source" id="hadith-source"></div>
        </div>
        <div class="dua-card">
          <div class="dua-title">ЁЯМЩ рж╕рж╛рж╣рж░рж┐рж░ ржирж┐рзЯржд</div>
          <div class="ar-font">┘Ж┘О┘И┘О┘К┘Т╪к┘П ╪г┘О┘Ж┘Т ╪г┘О╪╡┘П┘И┘Е┘О ╪║┘О╪п┘Л╪з ┘Е┘Р┘Ж┘Т ╪┤┘О┘З┘Т╪▒┘Р ╪▒┘О┘Е┘О╪╢┘О╪з┘Ж┘О ╪з┘Д┘Т┘Е┘П╪и┘О╪з╪▒┘О┘Г┘Р ┘Б┘О╪▒┘Т╪╢┘Л╪з ┘Д┘О┘Г┘О ┘К┘О╪з ╪з┘Д┘Д┘З┘П ┘Б┘О╪к┘О┘В┘О╪и┘С┘О┘Д┘Т ┘Е┘Р┘Ж┘Р┘С┘К ╪е┘Р┘Ж┘С┘О┘Г┘О ╪г┘О┘Ж┘Т╪к┘О ╪з┘Д╪│┘С┘О┘Е┘Р█М╪╣┘П ╪з┘Д┘Т╪╣┘О┘Д┘Р┘К┘Т┘Е┘П</div>
          <div class="onubad"><strong>ржЕржирзБржмрж╛ржж:</strong> рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ ржЖржЧрж╛ржорзАржХрж╛рж▓ ржкржмрж┐рждрзНрж░ рж░ржоржЬрж╛ржирзЗрж░ рж░рзЛржЬрж╛ рж░рж╛ржЦрж╛рж░ ржирж┐ржпрж╝ржд ржХрж░рж▓рж╛ржоред рждрзБржорж┐ ржЖржорж╛рж░ ржкржХрзНрж╖ ржерзЗржХрзЗ рждрж╛ ржХржмрзБрж▓ ржХрж░, ржирж┐рж╢рзНржЪржпрж╝ржЗ рждрзБржорж┐ рж╕рж░рзНржмрж╢рзНрж░рзЛрждрж╛ ржУ рж╕рж░рзНржмржЬрзНржЮред</div>
        </div>
        <div class="dua-card">
          <div class="dua-title">ЁЯд▓ ржЗржлрждрж╛рж░рзЗрж░ ржжрзБ'ржЖ</div>
          <div class="ar-font">╪з┘Д┘Д┘С┘О┘З┘П┘Е┘С┘О ┘Д┘О┘Г┘О ╪╡┘П┘Е┘Т╪к┘П ┘И┘О╪╣┘О┘Д┘О┘Й ╪▒┘Р╪▓┘Т┘В┘Р┘Г┘О ╪г┘О┘Б┘Т╪╖┘О╪▒┘Т╪к┘П</div>
          <div class="onubad"><strong>ржЕржирзБржмрж╛ржж:</strong> рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ рждрзЛржорж╛рж░ржЗ рж╕ржирзНрждрзБрж╖рзНржЯрж┐рж░ ржЬржирзНржп рж░рзЛржЬрж╛ рж░рзЗржЦрзЗржЫрж┐ ржПржмржВ рждрзЛржорж╛рж░ржЗ ржжрзЗржпрж╝рж╛ рж░рж┐ржЬрж┐ржХ ржжрзНржмрж╛рж░рж╛ ржЗржлрждрж╛рж░ ржХрж░ржЫрж┐ред</div>
        </div>
      </div>

      <div id="view-salat" style="display: none;">
        <div id="reward-card">
          <h2 style="font-size: 18px;">ржорж╛рж╢рж╛ржЖрж▓рзНрж▓рж╛рж╣! ЁЯОЙ</h2>
          <p style="margin-top: 5px; font-size: 14px;">ржЖржкржирж┐ ржЖржЬржХрзЗрж░ рзл ржУржпрж╝рж╛ржХрзНржд ржирж╛ржорж╛ржЬ рж╕ржорзНржкржирзНржи ржХрж░рзЗржЫрзЗржиред</p>
          <button class="reset-btn" onclick="resetTodaySalat()">рж░рж┐рж╕рзЗржЯ ржХрж░рзБржи</button>
        </div>
        <div class="dua-card">
          <div class="dua-title">ЁЯХЛ рзл ржУржпрж╝рж╛ржХрзНржд ржирж╛ржорж╛ржЬ ржЯрзНрж░рзНржпрж╛ржХрж╛рж░</div>
          <div class="progress-container"><div class="progress-bar" id="salat-progress"></div></div>
          <div class="salat-reminder">тЪая╕П рж╕рждрж░рзНржХрждрж╛: ржирж╛ржорж╛ржЬ ржирж╛ ржкрзЬрзЗ ржЯрж┐ржХ ржжрзЗржмрзЗржи ржирж╛ред</div>
          <div class="salat-list" id="salat-items-box">
            <div class="salat-item" onclick="toggleSalat('fajr')"><span class="salat-name">ржлржЬрж░</span><div class="salat-check" id="check-fajr"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg></div></div>
            <div class="salat-item" onclick="toggleSalat('dhuhr')"><span class="salat-name">ржпрзЛрж╣рж░</span><div class="salat-check" id="check-dhuhr"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg></div></div>
            <div class="salat-item" onclick="toggleSalat('asr')"><span class="salat-name">ржЖрж╕рж░</span><div class="salat-check" id="check-asr"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg></div></div>
            <div class="salat-item" onclick="toggleSalat('maghrib')"><span class="salat-name">ржорж╛ржЧрж░рж┐ржм</span><div class="salat-check" id="check-maghrib"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg></div></div>
            <div class="salat-item" onclick="toggleSalat('isha')"><span class="salat-name">ржПрж╢рж╛ ржУ рждрж╛рж░рж╛ржмрж┐</span><div class="salat-check" id="check-isha"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg></div></div>
          </div>
        </div>
      </div>
      <div id="view-schedule" style="display: none;">
        <div class="table-wrapper" id="table-container"></div>
      </div>
    </div>
  </div>

  <div class="floating-nav">
    <button class="nav-btn active" id="btn-hadith" onclick="switchV('view-hadith', 'btn-hadith')">ржжрзЛрзЯрж╛ ржУ рж╣рж╛ржжрж┐рж╕</button>
    <button class="nav-btn" id="btn-salat" onclick="switchV('view-salat', 'btn-salat')">рж╕рж╛рж▓рж╛ржд ржЯрзНрж░рзНржпрж╛ржХрж╛рж░</button>
    <button class="nav-btn" id="btn-schedule" onclick="switchV('view-schedule', 'btn-schedule')">ржкрзВрж░рзНржг рж╕рзВржЪрзА</button>
  </div>

  <div class="modal-overlay" id="update-modal">
    <div class="modal-content">
      <h2 class="modal-title">рж╕рж╛рж░рзНржнрж╛рж░ ржХрж╛ржирзЗржХрзНржЯрзЗржб</h2>
      <div class="modal-body">
        <div class="update-item"><span>тЬУ</span> Schedule text errors fixed (Bangla Month Names).</div>
        <div class="update-item"><span>тЬУ</span> Today (Feb 21) is set to 3rd Ramadan.</div>
        <div class="update-item"><span>тЬУ</span> Niyot Arabic font boxes cleanup done.</div>
      </div>
      <button class="btn-primary" onclick="closeUpdateModal()">ржЪрж╛рж▓рж┐рзЯрзЗ ржпрж╛ржи</button>
    </div>
  </div>

  <footer>Vibecoded by <a href="https://www.facebook.com/iamshakibali/" target="_blank" style="color: var(--accent-green); text-decoration: none; font-weight: 800;">Shakib</a> &copy; 2026</footer>
</div>

<script>
const dhakaBase = {
  sahri: ["5:12","5:11","5:11","5:10","5:09","5:08","5:08","5:07","5:06","5:05","5:05","5:04","5:03","5:02","5:01","5:00","4:59","4:58","4:57","4:57","4:56","4:55","4:54","4:53","4:52","4:51","4:50","4:49","4:48","4:47"],
  iftar: ["5:58","5:58","5:59","5:59","6:00","6:00","6:01","6:01","6:02","6:02","6:03","6:03","6:04","6:04","6:05","6:05","6:06","6:06","6:07","6:07","6:07","6:08","6:08","6:09","6:09","6:10","6:10","6:10","6:11","6:11"]
};

const offsets = { 
  "ржврж╛ржХрж╛": [0,0,"Dhaka"], "ржЧрж╛ржЬрзАржкрзБрж░": [-1,0,"Gazipur"], "ржирж╛рж░рж╛рзЯржгржЧржЮрзНржЬ": [-1,-1,"Narayanganj"], "ржЯрж╛ржЩрзНржЧрж╛ржЗрж▓": [1,1,"Tangail"], 
  "ржорзЯржоржирж╕рж┐ржВрж╣": [-1,-1,"Mymensingh"], "рж╢рзЗрж░ржкрзБрж░": [1,1,"Sherpur"], "ржЬрж╛ржорж╛рж▓ржкрзБрж░": [1,2,"Jamalpur"], "ржХрж┐рж╢рзЛрж░ржЧржЮрзНржЬ": [-3,-3,"Kishoreganj"], 
  "ржирзЗрждрзНрж░ржХрзЛржирж╛": [-3,-2,"Netrokona"], "рж╕рж┐рж▓рзЗржЯ": [-8,-8,"Sylhet"], "рж╕рзБржирж╛ржоржЧржЮрзНржЬ": [-6,-7,"Sunamganj"], "ржорзМрж▓ржнрзАржмрж╛ржЬрж╛рж░": [-7,-8,"Moulvibazar"], 
  "рж╣ржмрж┐ржЧржЮрзНржЬ": [-5,-6,"Habiganj"], "ржЪржЯрзНржЯржЧрзНрж░рж╛ржо": [-9,-5,"Chittagong"], "ржХржХрзНрж╕ржмрж╛ржЬрж╛рж░": [-10,-3,"Coxs Bazar"], "ржХрзБржорж┐рж▓рзНрж▓рж╛": [-4,-3,"Comilla"], 
  "ржмрзНрж░рж╛рж╣рзНржоржгржмрж╛рзЬрж┐рзЯрж╛": [-3,-3,"Brahmanbaria"], "ржлрзЗржирзА": [-5,-4,"Feni"], "ржирзЛрзЯрж╛ржЦрж╛рж▓рзА": [-4,-2,"Noakhali"], "рж▓ржХрзНрж╖рзНржорзАржкрзБрж░": [-2,-2,"Lakshmipur"], 
  "ржЪрж╛ржБржжржкрзБрж░": [-2,-2,"Chandpur"], "ржЦрж╛ржЧрзЬрж╛ржЫрзЬрж┐": [-7,-5,"Khagrachhari"], "рж░рж╛ржЩрзНржЧрж╛ржорж╛ржЯрж┐": [-8,-5,"Rangamati"], "ржмрж╛ржирзНржжрж░ржмрж╛ржи": [-8,-4,"Bandarban"], 
  "рж░рж╛ржЬрж╢рж╛рж╣рзА": [6,7,"Rajshahi"], "ржирж╛ржЯрзЛрж░": [5,6,"Natore"], "ржирзЛрзЯрж╛ржЧрж╛ржБ": [6,5,"Naogaon"], "ржЪрж╛ржБржкрж╛ржЗржиржмрж╛ржмржЧржЮрзНржЬ": [8,9,"Chapai Nawabganj"], 
  "ржкрж╛ржмржирж╛": [3,5,"Pabna"], "рж╕рж┐рж░рж╛ржЬржЧржЮрзНржЬ": [3,2,"Sirajganj"], "ржмржЧрзБрзЬрж╛": [3,3,"Bogra"], "ржЬржпрж╝ржкрзБрж░рж╣рж╛ржЯ": [5,4,"Joypurhat"], 
  "ржЦрзБрж▓ржирж╛": [3,5,"Khulna"], "ржмрж╛ржЧрзЗрж░рж╣рж╛ржЯ": [2,3,"Bagerhat"], "рж╕рж╛рждржХрзНрж╖рзАрж░рж╛": [4,6,"Satkhira"], "ржпрж╢рзЛрж░": [4,6,"Jessore"], 
  "ржорж╛ржЧрзБрж░рж╛": [3,4,"Magura"], "ржЭрж┐ржирж╛ржЗржжрж╣": [4,5,"Jhenaidah"], "ржирзЬрж╛ржЗрж▓": [3,4,"Narail"], "ржХрзБрж╖рзНржЯрж┐рзЯрж╛": [5,5,"Kushtia"], 
  "ржЪрзБрзЯрж╛ржбрж╛ржЩрзНржЧрж╛": [6,6,"Chuadanga"], "ржорзЗрж╣рзЗрж░ржкрзБрж░": [7,6,"Meherpur"], "ржмрж░рж┐рж╢рж╛рж▓": [1,2,"Barisal"], "ржнрзЛрж▓рж╛": [-2,0,"Bhola"], 
  "ржкржЯрзБрзЯрж╛ржЦрж╛рж▓рзА": [0,2,"Patuakhali"], "ржмрж░ржЧрзБржирж╛": [1,2,"Barguna"], "ржкрж┐рж░рзЛржЬржкрзБрж░": [2,3,"Pirojpur"], "ржЭрж╛рж▓ржХрж╛ржарж┐": [1,3,"Jhalokati"], 
  "рж░ржВржкрзБрж░": [5,2,"Rangpur"], "ржжрж┐ржирж╛ржЬржкрзБрж░": [6,4,"Dinajpur"], "ржЧрж╛ржЗржмрж╛ржирзНржзрж╛": [4,2,"Gaibandha"], "ржХрзБрзЬрж┐ржЧрзНрж░рж╛ржо": [3,0,"Kurigram"], 
  "рж▓рж╛рж▓ржоржирж┐рж░рж╣рж╛ржЯ": [4,2,"Lalmonirhat"], "ржирзАрж▓ржлрж╛ржорж╛рж░рзА": [6,3,"Nilphamari"], "ржкржЮрзНржЪржЧрзЬ": [8,5,"Panchagarh"], "ржарж╛ржХрзБрж░ржЧрж╛ржБржУ": [8,6,"Thakurgaon"], 
  "рж░рж╛ржЬржмрж╛рзЬрзА": [2,2,"Rajbari"], "рж╢рж░рзАржпрж╝рждржкрзБрж░": [-1,0,"Shariatpur"], "ржорж╛ржжрж╛рж░рзАржкрзБрж░": [0,1,"Madaripur"], "ржЧрзЛржкрж╛рж▓ржЧржЮрзНржЬ": [1,2,"Gopalganj"], 
  "ржлрж░рж┐ржжржкрзБрж░": [1,2,"Faridpur"], "ржорж╛ржирж┐ржХржЧржЮрзНржЬ": [1,1,"Manikganj"], "ржорзБржирзНрж╕рзАржЧржЮрзНржЬ": [-1,0,"Munshiganj"], "ржирж░рж╕рж┐ржВржжрзА": [-2,-1,"Narsingdi"] 
};

const districts = Object.keys(offsets).map(name => ({name, en: offsets[name][2]}));
const hadiths = [
  { ar: "┘Е┘О┘Ж┘Т ╪╡┘О╪з┘Е┘О ╪▒┘О┘Е┘О╪╢┘О╪з┘Ж┘О ╪е┘Р┘К┘Е┘О╪з┘Ж┘Л╪з ┘И┘О╪з╪н┘Т╪к┘Р╪│┘О╪з╪и┘Л╪з ╪║┘П┘Б┘Р╪▒┘О ┘Д┘О┘З┘П ┘Е┘О╪з ╪к┘О┘В┘О╪п┘О┘С┘Е┘О ┘Е┘Р┘Ж┘Т ╪░┘О┘Ж┘Т╪и┘Р┘З┘Р", bn: "ржпрзЗ ржмрзНржпржХрзНрждрж┐ ржИржорж╛ржи ржУ рж╕ржУржпрж╝рж╛ржмрзЗрж░ ржЖрж╢рж╛ржпрж╝ рж░ржоржЬрж╛ржирзЗрж░ рж░рзЛржЬрж╛ рж░рж╛ржЦржмрзЗ, рждрж╛рж░ ржЕрждрзАрждрзЗрж░ рж╕ржм ржЧрзБржирж╛рж╣ ржХрзНрж╖ржорж╛ ржХрж░рзЗ ржжрзЗржУржпрж╝рж╛ рж╣ржмрзЗред", source: "рж╕рж╣рзАрж╣ ржмрзБржЦрж╛рж░рзА: рззрзпрзжрзз" },
  { ar: "╪з┘Д╪╡┘Р┘С┘К┘О╪з┘Е┘П ╪м┘П┘Ж┘О┘С╪й┘М ┘Б┘О┘Д╪з ┘К┘О╪▒┘Т┘Б┘П╪л┘Т ┘И┘О┘Д╪з ┘К┘О╪м┘Т┘З┘О┘Д┘Т", bn: "рж░рзЛржЬрж╛ рж╣рж▓рзЛ ржврж╛рж▓ рж╕рзНржмрж░рзВржкред рж╕рзБрждрж░рж╛ржВ рж░рзЛржЬрж╛ржжрж╛рж░ ржпрзЗржи ржЕрж╢рзНрж▓рзАрж▓ ржХржерж╛ ржирж╛ ржмрж▓рзЗ ржПржмржВ ржЬрж╛рж╣рзЗрж▓рзА ржЖржЪрж░ржг ржирж╛ ржХрж░рзЗред", source: "рж╕рж╣рзАрж╣ ржмрзБржЦрж╛рж░рзА: рззрзорзпрзк" }
];

const API_KEY = "kNHP77qiE7gOlXo94g4l6h7G5DslnO9FDhejXzyW4Rq67XdU";
let fastingData = [], countdownInterval = null;

const toBn = s => s.toString().replace(/[0-9]/g, w => ({'0':'рзж','1':'рзз','2':'рзи','3':'рзй','4':'рзк','5':'рзл','6':'рзм','7':'рзн','8':'рзо','9':'рзп'})[w]);
const translate = t => toBn(t.replace('AM','ржнрзЛрж░').replace('PM','рж╕ржирзНржзрзНржпрж╛'));
const getTodayStr = () => {
    const d = new Date();
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
};

function addMinutes(timeStr, mins) {
  let [h, m] = timeStr.split(':').map(Number);
  let d = new Date(); d.setHours(h, m + mins, 0);
  return `${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;
}

const renderZila = f => {
  const el = document.getElementById('zila-list');
  if (!el) return; el.innerHTML = "";
  const filtered = districts.filter(d => d.name.includes(f) || d.en.toLowerCase().includes(f.toLowerCase()));
  filtered.forEach(z => {
    const dv = document.createElement('div'); dv.className = "zila-item"; dv.textContent = z.name;
    dv.onclick = () => { localStorage.setItem('selected_zila', JSON.stringify(z)); startApp(z); };
    el.appendChild(dv);
  });
};

function loadLocalData(zila) {
  const off = offsets[zila.name] || [0,0];
  return dhakaBase.sahri.map((s, i) => {
    const d = new Date(2026, 1, 19 + i);
    const dateStr = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
    return {
      date: dateStr,
      hijri_readable: `${i+1} Ramadan 1447 AH`,
      time: { sah: addMinutes(s, off[0]) + " AM", ift: addMinutes(dhakaBase.iftar[i], off[1]) + " PM" }
    };
  });
}

async function startApp(zila) {
  const loader = document.getElementById('loader');
  loader.style.display = 'flex';
  try {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), 800);
    const apiUrl = `https://api.islamicapi.com/v1/ramadan?key=${API_KEY}&city=${zila.en}&year=2026&country=Bangladesh`;
    const response = await fetch(apiUrl, { signal: controller.signal, mode: 'cors' });
    clearTimeout(id);
    if (!response.ok) throw new Error();
    const res = await response.json();
    if (res && res.data) {
      fastingData = res.data.map((item, i) => {
        const d = new Date(2026, 1, 19 + i);
        return {
          date: d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'),
          hijri_readable: `${i+1} Ramadan 1447 AH`,
          time: { sah: item.timings.Sehri + " AM", ift: item.timings.Iftar + " PM" }
        }
      });
    } else throw new Error();
  } catch (e) {
    fastingData = loadLocalData(zila);
  } finally {
    const todayStr = getTodayStr();
    let idx = fastingData.findIndex(r => r.date === todayStr);
    if (idx === -1) idx = 0; 
    const row = fastingData[idx];
    document.getElementById('city-name').textContent = zila.name;
    document.getElementById('hijri-display').textContent = row.hijri_readable.replace(/[0-9]/g, w => toBn(w));
    document.getElementById('fast-count').textContent = `рж░рзЛржЬрж╛ ${toBn(idx + 1)}/рзйрзж`;
    document.getElementById('fast-num').textContent = toBn(idx + 1);
    updateUI(row); 
    renderSchedule(fastingData); 
    setRandomHadith(); 
    loadSalatState();
    document.getElementById('splash').style.display = 'none'; 
    document.getElementById('app').style.display = 'block';
    startCountdown(row);
    loader.style.display = 'none';
  }
}

function switchV(v, b) {
  ['view-hadith', 'view-salat', 'view-schedule'].forEach(id => {
    const el = document.getElementById(id); if (el) el.style.display = id === v ? 'block' : 'none';
  });
  ['btn-hadith', 'btn-salat', 'btn-schedule'].forEach(id => {
    const el = document.getElementById(id); if (el) el.classList.toggle('active', id === b);
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateUI(r) {
  document.getElementById('summ-sahur').textContent = translate(r.time.sah);
  document.getElementById('summ-iftar').textContent = translate(r.time.ift);
  document.getElementById('duration-text').textContent = `рж╕рж╛рж╣рж░рж┐рж░ рж╢рзЗрж╖ рж╕ржорзЯ: ${toBn(r.time.sah.split(' ')[0])}`;
  document.getElementById('sunset-text').textContent = `ржЗржлрждрж╛рж░рзЗрж░ рж╕ржорзЯ: ${toBn(r.time.ift.split(' ')[0])}`;
}

function renderSchedule(data) {
  let h = `<table><thead><tr><th>рж░рзЛржЬрж╛</th><th>рждрж╛рж░рж┐ржЦ</th><th>рж╕рж╛рж╣рж░рж┐</th><th>ржЗржлрждрж╛рж░</th></tr></thead><tbody>`;
  const t = getTodayStr();
  const months = ['ржЬрж╛ржирзБ','ржлрзЗржмрзНрж░рзБ','ржорж╛рж░рзНржЪ'];
  data.forEach((r, i) => {
    const d = new Date(r.date);
    h += `<tr class="${r.date===t?'today-row':''}"><td>${toBn(i+1)}</td><td>${toBn(d.getDate())} ${months[d.getMonth()]}</td><td>${translate(r.time.sah)}</td><td>${translate(r.time.ift)}</td></tr>`;
  });
  document.getElementById('table-container').innerHTML = h + '</tbody></table>';
}

function setRandomHadith() {
  const h = hadiths[Math.floor(Math.random()*hadiths.length)];
  document.getElementById('hadith-ar').textContent = h.ar;
  document.getElementById('hadith-bn').innerHTML = `<strong>ржЕржирзБржмрж╛ржж:</strong> ${h.bn}`;
  document.getElementById('hadith-source').textContent = `рж╕рзЛрж░рзНрж╕: ${h.source}`;
}

function toggleSalat(id) {
  const k = `salat_${getTodayStr()}`; let s = JSON.parse(localStorage.getItem(k)) || {};
  s[id] = !s[id]; localStorage.setItem(k, JSON.stringify(s)); loadSalatState();
}

function resetTodaySalat() { localStorage.removeItem(`salat_${getTodayStr()}`); loadSalatState(); }

function loadSalatState() {
  const ids = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
  const state = JSON.parse(localStorage.getItem(`salat_${getTodayStr()}`)) || {};
  let count = 0;
  ids.forEach(id => {
    const el = document.getElementById(`check-${id}`).parentElement;
    if (state[id]) { el.classList.add('completed'); count++; } else el.classList.remove('completed');
  });
  const progress = document.getElementById('salat-progress');
  if(progress) progress.style.width = (count/5)*100 + '%';
  document.getElementById('reward-card').style.display = count === 5 ? 'block' : 'none';
}

function closeUpdateModal() { document.getElementById('update-modal').classList.remove('active'); localStorage.setItem('modal_v26_final_fix_v3', 'true'); }

function startCountdown(row) {
  if (countdownInterval) clearInterval(countdownInterval);
  const tk = () => {
    const now = new Date();
    const st = parseT(row.time.sah, row.date), it = parseT(row.time.ift, row.date);
    let target, label, nTime;
    if (now < st) { target = st; label = 'рж╕рж╛рж╣рж░рж┐ ржмрж╛ржХрж┐'; nTime = row.time.sah; }
    else if (now < it) { target = it; label = 'ржЗржлрждрж╛рж░ ржмрж╛ржХрж┐'; nTime = row.time.ift; }
    else {
      const tomorrow = fastingData.find(r => r.date > row.date);
      if (tomorrow) { target = parseT(tomorrow.time.sah, tomorrow.date); label = 'рж╕рж╛рж╣рж░рж┐ ржмрж╛ржХрж┐'; nTime = tomorrow.time.sah; }
      else { document.getElementById('timer-label').textContent = "ржЗржлрждрж╛рж░ рж╣рзЯрзЗржЫрзЗ"; return; }
    }
    const diff = target - now, h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
    document.getElementById('timer-label').textContent = label;
    document.getElementById('countdown-timer').textContent = toBn(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`);
    document.getElementById('next-event-time').textContent = translate(nTime);
  };
  tk(); countdownInterval = setInterval(tk, 1000);
}

function parseT(s, d) {
  if (!s) return new Date();
  const [t, m] = s.split(' '); let [h, mn] = t.split(':').map(Number);
  if(m==='PM'&&h!==12)h+=12; if(m==='AM'&&h===12)h=0;
  const date = new Date(d); date.setHours(h, mn, 0, 0); return date;
}

window.onload = () => {
  const s = localStorage.getItem('selected_zila');
  if(s) startApp(JSON.parse(s)); else { document.getElementById('loader').style.display='none'; document.getElementById('splash').style.display='flex'; renderZila(""); }
};
document.getElementById('zila-search').addEventListener('input', e => renderZila(e.target.value));
document.getElementById('change-city-btn').onclick = () => { document.getElementById('app').style.display='none'; document.getElementById('splash').style.display='flex'; renderZila(""); };
</script>
</body>
</html>
