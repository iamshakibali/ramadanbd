<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рж░ржоржЬрж╛ржи рзирзжрзирзм тАФ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla:ital@0;1&family=Inter:wght@300;400;500;600;700;800&family=Playpen+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #FFF8F0;
    --card-bg: #FFFFFF;
    --text-main: #2D2D2D;
    --text-muted: #6B7280;
    --accent-orange: #FF9F67;
    --accent-green: #A8C69F;
    --border: #F3E5D8;
    --sahur-grad: linear-gradient(180deg, #FFD5B4 0%, #FFF1E6 100%);
    --iftar-grad: linear-gradient(180deg, #E2F0D9 0%, #F4F9F1 100%);
    --font-bn: 'Tiro Bangla', serif;
    --font-en: 'Inter', sans-serif;
    --font-ar: 'Playpen Sans', cursive;
  }

  body {
    font-family: var(--font-bn);
    background-color: var(--bg);
    color: var(--text-main);
    min-height: 100vh;
    padding-bottom: 40px;
    -webkit-font-smoothing: antialiased;
  }

  .en-font { font-family: var(--font-en); letter-spacing: -0.02em; }
  .ar-font { font-family: var(--font-ar); direction: rtl; unicode-bidi: isolate; }

  #splash {
    position: fixed;
    inset: 0;
    background: var(--bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    padding: 20px;
  }

  .splash-card {
    background: var(--card-bg);
    border-radius: 28px;
    padding: 25px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.03);
    text-align: center;
    display: flex;
    flex-direction: column;
    max-height: 90vh;
  }

  h1.splash-title { font-size: 22px; margin-bottom: 15px; color: var(--text-main); }
  
  .search-box {
    width: 100%;
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid var(--border);
    font-family: var(--font-bn);
    margin-bottom: 10px;
    font-size: 15px;
    outline: none;
    background: #FAFAFA;
  }

  .zila-list {
    flex: 1;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 15px;
    text-align: left;
    background: #fff;
  }

  .zila-item {
    padding: 12px 15px;
    cursor: pointer;
    border-bottom: 1px solid #f9f9f9;
    font-size: 16px;
  }

  .zila-item:hover {
    background: var(--bg);
    color: var(--accent-orange);
    font-weight: 700;
  }

  .btn-primary {
    width: 100%;
    padding: 14px;
    border-radius: 16px;
    border: none;
    background: var(--accent-orange);
    color: white;
    font-weight: 700;
    cursor: pointer;
    font-size: 16px;
    font-family: var(--font-bn);
  }

  #app { display: none; max-width: 480px; margin: 0 auto; padding: 16px; }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    padding: 0 4px;
  }

  .hijri-title { font-size: 20px; font-weight: 700; color: #444; }
  .current-date { font-size: 14px; color: var(--text-muted); font-family: var(--font-en); font-weight: 500; }

  .location-box {
    text-align: right;
    cursor: pointer;
    padding: 4px;
    border-radius: 8px;
  }
  .active-city { font-size: 16px; font-weight: 700; color: var(--text-main); display: flex; align-items: center; justify-content: flex-end; gap: 4px; }
  .change-city-text { font-size: 11px; color: var(--accent-orange); font-weight: 600; margin-top: -2px; }

  .hero-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }

  .hero-card {
    border-radius: 24px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 190px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.02);
  }

  .card-orange { background: var(--sahur-grad); }
  .card-green { background: var(--iftar-grad); }

  .hero-card label { font-size: 13px; color: var(--text-main); font-weight: 600; opacity: 0.8; }
  .hero-card .event-name { font-size: 19px; font-weight: 700; color: #E07A5F; margin-top: 2px; }
  .hero-card.card-green .event-name { color: #84A98C; }
  
  .hero-card .time-val { font-size: 34px; font-weight: 800; color: var(--text-main); font-family: var(--font-en); margin-top: 10px; }
  .hero-card .sub-text { font-size: 13px; color: var(--text-muted); font-family: var(--font-bn); font-weight: 400; margin-top: 5px;}

  .summary-bar {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 16px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.02);
  }

  .summary-item { display: flex; align-items: center; gap: 12px; }
  .summary-label { font-size: 14px; color: var(--text-muted); font-weight: 600; }
  .summary-time { font-size: 18px; font-weight: 700; font-family: var(--font-en); color: var(--text-main); }

  .toggle-container {
    display: flex;
    background: #EEE7DE;
    padding: 4px;
    border-radius: 16px;
    margin-bottom: 20px;
  }

  .toggle-btn {
    flex: 1;
    border: none;
    padding: 10px;
    border-radius: 12px;
    font-family: var(--font-bn);
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    background: transparent;
    color: var(--text-muted);
  }

  .toggle-btn.active {
    background: var(--card-bg);
    color: var(--accent-orange);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .dua-section { margin-top: 0; margin-bottom: 30px; }
  
  .hadith-card {
    background: #FFFBF0;
    border-radius: 24px;
    padding: 22px;
    margin-bottom: 16px;
    border: 1px solid #F3E5D8;
    box-shadow: 0 4px 10px rgba(0,0,0,0.01);
  }
  .hadith-title { font-weight: 700; font-size: 15px; color: #8B4513; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
  .hadith-ar { font-family: var(--font-ar); font-size: 1.1rem; line-height: 1.6; text-align: right; margin-bottom: 10px; color: #222; direction: rtl; }
  .hadith-bn { font-size: 18px; color: var(--text-main); line-height: 1.6; font-weight: 400; font-style: italic; }

  .dua-card { background: white; border-radius: 24px; padding: 22px; margin-bottom: 16px; border: 1px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.01); }
  .dua-title { font-weight: 700; font-size: 15px; color: var(--accent-orange); margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
  .dua-arabic { font-family: var(--font-ar); font-size: 1.2rem; line-height: 1.7; text-align: right; margin-bottom: 14px; color: #111; direction: rtl; }
  .dua-label { font-size: 12px; color: var(--accent-orange); font-weight: 700; margin-bottom: 2px; display: block; }
  .dua-text { font-size: 18px; color: var(--text-main); line-height: 1.6; margin-bottom: 10px; font-weight: 400; }

  .table-wrapper {
    background: white;
    border-radius: 24px;
    overflow: hidden;
    border: 1px solid var(--border);
    box-shadow: 0 4px 20px rgba(0,0,0,0.02);
  }

  table { width: 100%; border-collapse: collapse; font-size: 14px; }
  th { background: #fdf2e9; padding: 14px; text-align: left; font-weight: 700; color: #7c4a1e; }
  td { padding: 14px; border-bottom: 1px solid #FFF1E6; font-weight: 500; }
  tr.today-row { background: #FFF9F0; border-left: 4px solid var(--accent-orange); }

  .bn-time { font-family: var(--font-en); font-weight: 700; }

  footer { 
    text-align: center; 
    padding: 2.5rem; 
    color: var(--text-muted); 
    font-weight: 500; 
    font-size: 0.9rem; 
    border-top: 1px solid var(--border); 
    margin-top: 40px; 
    font-family: var(--font-en);
  }
  footer a { color: var(--accent-orange); text-decoration: none; font-weight: 700; }

  #loading-overlay {
    position: fixed;
    inset: 0;
    background: var(--bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 150;
  }
</style>
</head>
<body>

<div id="loading-overlay">
  <div style="font-size: 32px;">ЁЯМЩ</div>
  <div style="margin-top: 10px; font-size: 14px; color: var(--text-muted);">рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</div>
</div>

<div id="splash" style="display:none;">
  <div class="splash-card">
    <div style="font-size: 40px; margin-bottom: 10px;">ЁЯМЩ</div>
    <h1 class="splash-title">рж░ржоржЬрж╛ржи ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░ рзирзжрзирзм</h1>
    <input type="text" id="zila-search" class="search-box" placeholder="ржЖржкржирж╛рж░ ржЬрзЗрж▓рж╛ ржЦрзБржБржЬрзБржи (ржмрж╛ржВрж▓рж╛ ржмрж╛ ржЗржВрж░рзЗржЬрж┐)">
    <div id="zila-list" class="zila-list"></div>
    <button class="btn-primary" id="gps-btn">ЁЯУН ржЖржорж╛рж░ ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ржи</button>
  </div>
</div>

<div id="app">
  <div class="header">
    <div>
      <div class="hijri-title" id="hijri-date-title">ржкржмрж┐рждрзНрж░ рж░ржоржЬрж╛ржи, рззрзкрзкрзн</div>
      <div class="current-date" id="current-full-date">рж╢рзБржХрзНрж░ржмрж╛рж░, рзирзж ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐ рзирзжрзирзм</div>
    </div>
    <div class="location-box" id="change-location-trigger">
      <div class="active-city"><span id="active-city-name">ржврж╛ржХрж╛</span> ЁЯУН</div>
      <div class="change-city-text">ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи</div>
    </div>
  </div>

  <div class="hero-container">
    <div class="hero-card card-orange">
      <div>
        <label>ржПржЦржи рж╕ржорзЯ</label>
        <div class="event-name" id="timer-label">рж╕рж╛рж╣рж░рж┐ ржмрж╛ржХрж┐</div>
      </div>
      <div class="time-val en-font" id="countdown-timer">рзжрзж:рзжрзж:рзжрзж</div>
      <div class="sub-text" id="duration-text">рж░рзЛржЬрж╛рж░ рж╕ржорзЯржХрж╛рж▓: рж▓рзЛржб рж╣ржЪрзНржЫрзЗ</div>
    </div>
    <div class="hero-card card-green">
      <div>
        <label>ржкрж░ржмрж░рзНрждрзА ржЗржнрзЗржирзНржЯ</label>
        <div class="event-name" id="next-event-label">ржЗржлрждрж╛рж░ рж╢рзБрж░рзБ</div>
      </div>
      <div class="time-val en-font" id="next-event-time">--:-- --</div>
      <div class="sub-text" id="sunset-text">рж╕рзВрж░рзНржпрж╛рж╕рзНржд: --:--</div>
    </div>
  </div>

  <div class="summary-bar">
    <div class="summary-item">
      <div class="summary-label">рж╕рж╛рж╣рж░рж┐ рж╢рзЗрж╖</div>
      <div class="summary-time en-font" id="summ-sahur">--:-- --</div>
    </div>
    <div style="width: 1px; height: 24px; background: #EEE;"></div>
    <div class="summary-item">
      <div class="summary-label">ржЗржлрждрж╛рж░ рж╢рзБрж░рзБ</div>
      <div class="summary-time en-font" id="summ-iftar">--:-- --</div>
    </div>
  </div>

  <div class="toggle-container">
    <button class="toggle-btn active" id="btn-hadith">ржЖржЬржХрзЗрж░ рж╣рж╛ржжрж┐рж╕</button>
    <button class="toggle-btn" id="btn-schedule">рзйрзж ржжрж┐ржирзЗрж░ рж╕рзВржЪрзА</button>
  </div>

  <div id="hadith-view">
    <div class="hadith-card" id="dynamic-hadith-card">
      <div class="hadith-title">ЁЯУЦ ржЖржЬржХрзЗрж░ рж╣рж╛ржжрж┐рж╕</div>
      <div class="hadith-ar ar-font" id="hadith-ar-display"></div>
      <div class="hadith-bn" id="hadith-bn-display">рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</div>
    </div>
  </div>

  <div id="full-schedule-view" style="display: none;">
    <div class="table-wrapper" id="schedule-container"></div>
  </div>

  <div class="dua-section">
    <div class="dua-card">
      <div class="dua-title">ЁЯМЩ рж╕рж╛рж╣рж░рж┐рж░ ржирж┐рзЯржд</div>
      <div class="dua-arabic ar-font">┘Ж┘О┘И┘О┘К┘Т╪к┘П ╪г┘О┘Ж┘Т ╪г┘О╪╡┘П┘И┘Е┘О ╪║┘О╪п┘Л╪з ┘Е┘Р┘Ж┘Т ╪┤┘О┘З┘Т╪▒┘Р ╪▒┘О┘Е┘О╪╢┘О╪з┘Ж┘О ╪з┘Д┘Т┘Е┘П╪и┘О╪з╪▒┘О┘Г┘Р ┘Б┘О╪▒┘Т╪╢┘Л╪з ┘Д┘О┘Г┘О ┘К┘О╪з ╪з┘Д┘Д┘З┘П ┘Б┘О╪к┘О┘В┘О╪и┘С┘О┘Д┘Т ┘Е┘Р┘Ж┘Р┘С┘К ╪е┘Р┘Ж┘С┘О┘Г┘О ╪г┘О┘Ж┘Т╪к┘О ╪з┘Д╪│┘С┘О┘Е┘Р█М╪╣┘П ╪з┘Д┘Т╪╣┘О┘Д┘Р┘К┘Т┘Е┘П</div>
      <span class="dua-label">ржЙржЪрзНржЪрж╛рж░ржг:</span>
      <div class="dua-text">ржирж╛ржУржпрж╝рж╛ржЗрждрзБ ржЖржи ржЖржЫрзБржорж╛ ржЧрж╛ржжрж╛ржо ржорж┐ржи рж╢рж╛рж╣рж░рж┐ рж░рж╛ржорж╛ржжрзНржмрж╛ржирж╛рж▓ ржорзБржмрж╛рж░рж╛ржХрж┐ ржлрж╛рж░ржжрзНржмрж╛рж▓рзНрж▓рж╛ржХрж╛ ржЗржпрж╝рж╛ ржЖрж▓рзНрж▓рж╛рж╣рзБ ржлрж╛рждрж╛ржХрзНржмрж╛ржмрзНржмрж╛рж▓ ржорж┐ржирзНржирзА ржЗржирзНржирж╛ржХрж╛ ржЖржирзНрждрж╛рж╕ рж╕рж╛ржорзАржЙрж▓ ржЖрж▓рзАржоред</div>
      <span class="dua-label">ржЕрж░рзНрже:</span>
      <div class="dua-text">рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ ржЖржЧрж╛ржорзАржХрж╛рж▓ ржкржмрж┐рждрзНрж░ рж░ржоржЬрж╛ржирзЗрж░ рж░рзЛржЬрж╛ рж░рж╛ржЦрж╛рж░ ржирж┐ржпрж╝ржд ржХрж░рж▓рж╛ржоред рждрзБржорж┐ ржЖржорж╛рж░ ржкржХрзНрж╖ ржерзЗржХрзЗ рждрж╛ ржХржмрзБрж▓ ржХрж░, ржирж┐рж╢рзНржЪржпрж╝ржЗ рждрзБржорж┐ рж╕рж░рзНржмрж╢рзНрж░рзЛрждрж╛ ржУ рж╕рж░рзНржмржЬрзНржЮред</div>
    </div>
    <div class="dua-card">
      <div class="dua-title">ЁЯд▓ ржЗржлрждрж╛рж░рзЗрж░ ржжрзБ'ржЖ</div>
      <div class="dua-arabic ar-font">╪з┘Д┘Д┘С┘О┘З┘П┘Е┘С┘О ┘Д┘О┘Г┘О ╪╡┘П┘Е┘Т╪к┘П ┘И┘О╪╣┘О┘Д┘О┘Й ╪▒┘Р╪▓┘Т┘В┘Р┘Г┘О ╪г┘О┘Б┘Т╪╖┘О╪▒┘Т╪к┘П</div>
      <span class="dua-label">ржЙржЪрзНржЪрж╛рж░ржг:</span>
      <div class="dua-text">ржЖрж▓рзНрж▓рж╛рж╣рзБржорзНржорж╛ рж▓рж╛ржХрж╛ ржЫрзБржорждрзБ ржУрзЯрж╛ ржЖрж▓рж╛ рж░рж┐ржпржХрзНржмрж┐ржХрж╛ ржЖржлрждрж╛рж░рждрзБред</div>
      <span class="dua-label">ржЕрж░рзНрже:</span>
      <div class="dua-text">рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ рждрзЛржорж╛рж░ржЗ рж╕ржирзНрждрзБрж╖рзНржЯрж┐рж░ ржЬржирзНржп рж░рзЛржЬрж╛ рж░рзЗржЦрзЗржЫрж┐ ржПржмржВ рждрзЛржорж╛рж░ржЗ ржжрзЗржпрж╝рж╛ рж░рж┐ржЬрж┐ржХ ржжрзНржмрж╛рж░рж╛ ржЗржлрждрж╛рж░ ржХрж░ржЫрж┐ред</div>
    </div>
  </div>

  <footer>
    Vibecoded by <a href="https://www.facebook.com/iamshakibali/" target="_blank">Shakib</a>. All rights reserved &copy; 2026
  </footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const districts = [
  {name: "ржврж╛ржХрж╛", en: "Dhaka", lat: 23.8103, lon: 90.4125}, {name: "ржЧрж╛ржЬрзАржкрзБрж░", en: "Gazipur", lat: 23.9999, lon: 90.4200}, 
  {name: "ржирж╛рж░рж╛рзЯржгржЧржЮрзНржЬ", en: "Narayanganj", lat: 23.6238, lon: 90.5000}, {name: "ржирж░рж╕рж┐ржВржжрзА", en: "Narsingdi", lat: 23.9229, lon: 90.7177}, 
  {name: "ржорзБржирзНрж╕рзАржЧржЮрзНржЬ", en: "Munshiganj", lat: 23.6061, lon: 90.4996}, {name: "ржорж╛ржирж┐ржХржЧржЮрзНржЬ", en: "Manikganj", lat: 23.8644, lon: 90.0047},
  {name: "ржлрж░рж┐ржжржкрзБрж░", en: "Faridpur", lat: 23.6071, lon: 89.8429}, {name: "рж░рж╛ржЬржмрж╛рзЬрзА", en: "Rajbari", lat: 23.5089, lon: 89.7884}, 
  {name: "ржЧрзЛржкрж╛рж▓ржЧржЮрзНржЬ", en: "Gopalganj", lat: 23.2106, lon: 89.8517}, {name: "ржорж╛ржжрж╛рж░рзАржкрзБрж░", en: "Madaripur", lat: 23.1676, lon: 90.2103}, 
  {name: "рж╢рж░рзАржпрж╝рждржкрзБрж░", en: "Shariatpur", lat: 23.2160, lon: 90.3486}, {name: "ржЯрж╛ржЩрзНржЧрж╛ржЗрж▓", en: "Tangail", lat: 24.2513, lon: 89.9167},
  {name: "ржХрж┐рж╢рзЛрж░ржЧржЮрзНржЬ", en: "Kishoreganj", lat: 24.4331, lon: 90.7866}, {name: "ржЪржЯрзНржЯржЧрзНрж░рж╛ржо", en: "Chittagong", lat: 22.3569, lon: 91.7832}, 
  {name: "ржХржХрзНрж╕ржмрж╛ржЬрж╛рж░", en: "Cox's Bazar", lat: 21.4272, lon: 92.0058}, {name: "ржХрзБржорж┐рж▓рзНрж▓рж╛", en: "Comilla", lat: 23.4607, lon: 91.1809}, 
  {name: "ржмрзНрж░рж╛рж╣рзНржоржгржмрж╛ржбрж╝рж┐ржпрж╝рж╛", en: "Brahmanbaria", lat: 23.9571, lon: 91.1167}, {name: "ржирзЛржпрж╝рж╛ржЦрж╛рж▓рзА", en: "Noakhali", lat: 22.1600, lon: 91.1333},
  {name: "ржЪрж╛ржБржжржкрзБрж░", en: "Chandpur", lat: 23.2321, lon: 90.6631}, {name: "ржлрзЗржирзА", en: "Feni", lat: 22.8300, lon: 91.1000}, 
  {name: "рж▓ржХрзНрж╖рзНржорзАржкрзБрж░", en: "Lakshmipur", lat: 22.9447, lon: 90.8282}, {name: "ржЦрж╛ржЧржбрж╝рж╛ржЫржбрж╝рж┐", en: "Khagrachhari", lat: 23.1073, lon: 91.9363}, 
  {name: "рж░рж╛ржЩрж╛ржорж╛ржЯрж┐", en: "Rangamati", lat: 22.6574, lon: 92.1731}, {name: "ржмрж╛ржирзНржжрж░ржмрж╛ржи", en: "Bandarban", lat: 22.1953, lon: 92.2184},
  {name: "рж░рж╛ржЬрж╢рж╛рж╣рзА", en: "Rajshahi", lat: 24.3636, lon: 88.6241}, {name: "ржмржЧрзБржбрж╝рж╛", en: "Bogra", lat: 24.8481, lon: 89.3730}, 
  {name: "ржирж╛ржЯрзЛрж░", en: "Natore", lat: 24.3635, lon: 88.9849}, {name: "ржЪрж╛ржБржкрж╛ржЗржиржмрж╛ржмржЧржЮрзНржЬ", en: "Chapai Nawabganj", lat: 24.5884, lon: 88.8715}, 
  {name: "ржиржУржЧрж╛ржБ", en: "Naogaon", lat: 24.8912, lon: 88.9515}, {name: "рж╕рж┐рж░рж╛ржЬржЧржЮрзНржЬ", en: "Sirajganj", lat: 24.0000, lon: 89.2500},
  {name: "ржкрж╛ржмржирж╛", en: "Pabna", lat: 24.0158, lon: 89.2335}, {name: "ржЬржпрж╝ржкрзБрж░рж╣рж╛ржЯ", en: "Joypurhat", lat: 25.1011, lon: 89.0225}, 
  {name: "ржЦрзБрж▓ржирж╛", en: "Khulna", lat: 22.8456, lon: 89.5403}, {name: "ржпрж╢рзЛрж░", en: "Jessore", lat: 23.1664, lon: 89.2137}, 
  {name: "рж╕рж╛рждржХрзНрж╖рзАрж░рж╛", en: "Satkhira", lat: 22.7185, lon: 89.0705}, {name: "ржмрж╛ржЧрзЗрж░рж╣рж╛ржЯ", en: "Bagerhat", lat: 22.6516, lon: 89.7859},
  {name: "ржорж╛ржЧрзБрж░рж╛", en: "Magura", lat: 23.5424, lon: 89.1726}, {name: "ржЭрж┐ржирж╛ржЗржжрж╣", en: "Jhenaidah", lat: 23.5450, lon: 89.1536}, 
  {name: "ржирзЬрж╛ржЗрж▓", en: "Narail", lat: 23.1683, lon: 89.4908}, {name: "ржХрзБрж╖рзНржЯрж┐ржпрж╝рж╛", en: "Kushtia", lat: 23.9010, lon: 89.1204}, 
  {name: "ржЪрзБржпрж╝рж╛ржбрж╛ржЩрзНржЧрж╛", en: "Chuadanga", lat: 23.6336, lon: 88.8477}, {name: "ржорзЗрж╣рзЗрж░ржкрзБрж░", en: "Meherpur", lat: 23.7621, lon: 88.6318},
  {name: "рж╕рж┐рж▓рзЗржЯ", en: "Sylhet", lat: 24.8949, lon: 91.8687}, {name: "рж╕рзБржирж╛ржоржЧржЮрзНржЬ", en: "Sunamganj", lat: 25.0662, lon: 91.3992}, 
  {name: "ржорзМрж▓ржнрзАржмрж╛ржЬрж╛рж░", en: "Moulvibazar", lat: 24.4252, lon: 91.7637}, {name: "рж╣ржмрж┐ржЧржЮрзНржЬ", en: "Habiganj", lat: 24.3745, lon: 91.4126}, 
  {name: "ржмрж░рж┐рж╢рж╛рж▓", en: "Barisal", lat: 22.7010, lon: 90.3535}, {name: "ржнрзЛрж▓рж╛", en: "Bhola", lat: 22.3303, lon: 90.3347},
  {name: "ржкржЯрзБржпрж╝рж╛ржЦрж╛рж▓рзА", en: "Patuakhali", lat: 22.3596, lon: 90.2158}, {name: "ржмрж░ржЧрзБржирж╛", en: "Barguna", lat: 22.1285, lon: 90.1219}, 
  {name: "ржкрж┐рж░рзЛржЬржкрзБрж░", en: "Pirojpur", lat: 22.5781, lon: 89.9708}, {name: "ржЭрж╛рж▓ржХрж╛ржарж┐", en: "Jhalokati", lat: 22.6406, lon: 90.1989}, 
  {name: "рж░ржВржкрзБрж░", en: "Rangpur", lat: 25.7439, lon: 89.2752}, {name: "ржжрж┐ржирж╛ржЬржкрзБрж░", en: "Dinajpur", lat: 25.7200, lon: 88.5950},
  {name: "ржХрзБржбрж╝рж┐ржЧрзНрж░рж╛ржо", en: "Kurigram", lat: 25.8054, lon: 89.6361}, {name: "рж▓рж╛рж▓ржоржирж┐рж░рж╣рж╛ржЯ", en: "Lalmonirhat", lat: 25.9298, lon: 89.4404}, 
  {name: "ржирзАрж▓ржлрж╛ржорж╛рж░рзА", en: "Nilphamari", lat: 25.9317, lon: 88.8549}, {name: "ржЧрж╛ржЗржмрж╛ржирзНржзрж╛", en: "Gaibandha", lat: 25.3287, lon: 89.5426}, 
  {name: "ржкржЮрзНржЪржЧржбрж╝", en: "Panchagarh", lat: 26.3353, lon: 88.5516}, {name: "ржарж╛ржХрзБрж░ржЧрж╛ржБржУ", en: "Thakurgaon", lat: 26.0336, lon: 88.4616},
  {name: "ржоржпрж╝ржоржирж╕рж┐ржВрж╣", en: "Mymensingh", lat: 24.7471, lon: 90.4203}, {name: "ржЬрж╛ржорж╛рж▓ржкрзБрж░", en: "Jamalpur", lat: 24.8837, lon: 90.0002}, 
  {name: "ржирзЗрждрзНрж░ржХрзЛржирж╛", en: "Netrokona", lat: 24.8700, lon: 90.7275}, {name: "рж╢рзЗрж░ржкрзБрж░", en: "Sherpur", lat: 25.0194, lon: 90.0153}
];

const hadiths = [
  {ar: "┘Е┘О┘Ж┘Т ╪╡┘О╪з┘Е┘О ╪▒┘О┘Е┘О╪╢┘О╪з┘Ж┘О ╪е┘Р┘К┘Е┘О╪з┘Ж┘Л╪з ┘И┘О╪з╪н┘Т╪к┘Р╪│┘О╪з╪и┘Л╪з ╪║┘П┘Б┘Р╪▒┘О ┘Д┘О┘З┘П ┘Е┘О╪з ╪к┘О┘В┘О╪п┘О┘С┘Е┘О ┘Е┘Р┘Ж┘Т ╪░┘О┘Ж┘Т╪и┘Р┘З┘Р", bn: "ржпрзЗ ржмрзНржпржХрзНрждрж┐ ржИржорж╛ржи ржУ рж╕ржУржпрж╝рж╛ржмрзЗрж░ ржЖрж╢рж╛ржпрж╝ рж░ржоржЬрж╛ржирзЗрж░ рж░рзЛржЬрж╛ рж░рж╛ржЦржмрзЗ, рждрж╛рж░ ржЕрждрзАрждрзЗрж░ рж╕ржм ржЧрзБржирж╛рж╣ ржХрзНрж╖ржорж╛ ржХрж░рзЗ ржжрзЗржУржпрж╝рж╛ рж╣ржмрзЗред (рж╕рж╣рзАрж╣ ржмрзБржЦрж╛рж░рзА)"},
  {ar: "┘Г┘П┘Д┘П┘С ╪╣┘О┘Е┘О┘Д┘Р ╪з╪и┘Т┘Ж┘Р ╪в╪п┘О┘Е┘О ┘Д┘О┘З┘П ╪е┘Р┘Д┘О┘С╪з ╪з┘Д╪╡┘Р┘С┘К┘О╪з┘Е┘О ┘Б┘О╪е┘Р┘Ж┘О┘С┘З┘П ┘Д┘Р┘К ┘И┘О╪г┘О┘Ж┘О╪з ╪г┘О╪м┘Т╪▓┘Р┘К ╪и┘Р┘З┘Р", bn: "ржкрзНрж░рждрж┐ржЯрж┐ ржирзЗржХ ржЖржорж▓рзЗрж░ рж╕ржУржпрж╝рж╛ржм рззрзж ржерзЗржХрзЗ рзнрзжрзж ржЧрзБржг ржкрж░рзНржпржирзНржд ржмрзГржжрзНржзрж┐ ржХрж░рж╛ рж╣ржпрж╝ред ржХрж┐ржирзНрждрзБ рж░рзЛржЬрж╛рж░ ржмрзНржпрж╛ржкрж╛рж░рзЗ ржЖрж▓рзНрж▓рж╛рж╣ ржмрж▓рзЗржи, рж░рзЛржЬрж╛ ржЖржорж╛рж░ржЗ ржЬржирзНржп ржПржмржВ ржЖржорж┐ ржирж┐ржЬрзЗржЗ ржПрж░ ржкрзНрж░рждрж┐ржжрж╛ржи ржжрзЗржмред (рж╕рж╣рзАрж╣ ржорзБрж╕рж▓рж┐ржо)"},
  {ar: "┘Д┘О╪о┘П┘Д┘П┘И┘Б┘П ┘Б┘О┘Е┘Р ╪з┘Д╪╡┘О┘С╪з╪ж┘Р┘Е┘Р ╪г┘О╪╖┘Т┘К┘О╪и┘П ╪╣┘Р┘Ж┘Т╪п┘О ╪з┘Д┘Д┘О┘С┘З┘Р ┘Е┘Р┘Ж┘Т ╪▒┘Р┘К╪н┘Р ╪з┘Д┘Т┘Е┘Р╪│┘Т┘Г┘Р", bn: "рж░рзЛржЬрж╛ржжрж╛рж░рзЗрж░ ржорзБржЦрзЗрж░ ржШрзНрж░рж╛ржг ржЖрж▓рзНрж▓рж╛рж╣рж░ ржХрж╛ржЫрзЗ ржорж┐рж╢ржХрзЗрж░ рж╕рзБржЧржирзНржзрж┐рж░ ржЪрзЗржпрж╝рзЗржУ ржмрзЗрж╢рж┐ ржкрзНрж░рж┐ржпрж╝ред (рж╕рж╣рзАрж╣ ржмрзБржЦрж╛рж░рзА)"},
  {ar: "╪к┘О╪│┘О╪н┘О┘С╪▒┘П┘И╪з ┘Б┘О╪е┘Р┘Ж┘О┘С ┘Б┘Р┘К ╪з┘Д╪│┘О┘С╪н┘П┘И╪▒┘Р ╪и┘О╪▒┘О┘Г┘О╪й┘Л", bn: "рж╕рзЗрж╣рж░рж┐ ржЦрж╛ржУ, ржХрж╛рж░ржг рж╕рзЗрж╣рж░рж┐рждрзЗ ржмрж░ржХржд рж░ржпрж╝рзЗржЫрзЗред (рж╕рж╣рзАрж╣ ржмрзБржЦрж╛рж░рзА)"}
];

let fastingData = [];
let countdownInterval = null;
let currentHadithIndex = 0;

const toBengaliDigits = (str) => str ? str.toString().replace(/[0-9]/g, w => ({'0':'рзж','1':'рзз','2':'рзи','3':'рзй','4':'рзк','5':'рзл','6':'рзм','7':'рзн','8':'рзо','9':'рзп'})[w]) : '';
const translateTimeToBengali = (timeStr) => timeStr ? toBengaliDigits(timeStr.replace('AM', 'ржнрзЛрж░').replace('PM', 'рж╕ржирзНржзрзНржпрж╛')) : '';
const todayDateStr = () => { const d = new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; };

const parseTime = (str) => {
  const d = new Date();
  if (str.includes('AM') || str.includes('PM')) {
    const [time, meridiem] = str.split(' ');
    let [h, m] = time.split(':').map(Number);
    if (meridiem === 'PM' && h !== 12) h += 12;
    if (meridiem === 'AM' && h === 12) h = 0;
    d.setHours(h, m, 0, 0);
  } else {
    const [h, m] = str.split(':').map(Number);
    d.setHours(h, m, 0, 0);
  }
  return d;
};

async function fetchRamadan(lat, lon, cityName) {
  document.getElementById('loading-overlay').style.display = 'flex';
  const url = `https://islamicapi.com/api/v1/ramadan/?lat=${lat}&lon=${lon}&api_key=rH5NxFBCblP5kc8zJjgB6VcQzfrf6tI0GIch2HoBkiNZFQZs&method=1&school=2&format=12`;
  try {
    const res = await fetch(url);
    const json = await res.json();
    fastingData = json.data.fasting;
    const today = todayDateStr();
    const todayRow = fastingData.find(r => r.date === today);
    
    document.getElementById('active-city-name').textContent = cityName;
    document.getElementById('current-full-date').textContent = new Date().toLocaleDateString('bn-BD', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
    
    if (todayRow) {
      document.getElementById('summ-sahur').textContent = translateTimeToBengali(todayRow.time.sahur);
      document.getElementById('summ-iftar').textContent = translateTimeToBengali(todayRow.time.iftar);
      document.getElementById('sunset-text').textContent = `рж╕рзВрж░рзНржпрж╛рж╕рзНржд: ${toBengaliDigits(todayRow.time.iftar.split(' ')[0])}`;
      document.getElementById('hijri-date-title').textContent = toBengaliDigits(todayRow.hijri_readable);
      const dur = todayRow.time.duration.replace('hours', 'ржШржгрзНржЯрж╛').replace('minutes', 'ржорж┐ржирж┐ржЯ');
      document.getElementById('duration-text').textContent = `рж░рзЛржЬрж╛рж░ рж╕ржорзЯржХрж╛рж▓: ${toBengaliDigits(dur)}`;
      
      const iTimeStr = translateTimeToBengali(todayRow.time.iftar);
      document.getElementById('next-event-time').textContent = iTimeStr;
    }

    renderSchedule(json.data);
    document.getElementById('splash').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    document.getElementById('loading-overlay').style.display = 'none';
    
    rotateHadith();
    if (!window.hadithInterval) window.hadithInterval = setInterval(rotateHadith, 15000);
    startCountdown();
  } catch (err) {
    document.getElementById('loading-overlay').style.display = 'none';
    document.getElementById('splash').style.display = 'flex';
  }
}

function rotateHadith() {
  currentHadithIndex = (currentHadithIndex + 1) % hadiths.length;
  document.getElementById('hadith-bn-display').textContent = hadiths[currentHadithIndex].bn;
  document.getElementById('hadith-ar-display').textContent = hadiths[currentHadithIndex].ar;
}

function startCountdown() {
  if (countdownInterval) clearInterval(countdownInterval);
  const tk = () => {
    const today = todayDateStr();
    const todayFast = fastingData.find(r => r.date === today);
    if (!todayFast) return;
    const now = new Date();
    const sTime = parseTime(todayFast.time.sahur);
    const iTime = parseTime(todayFast.time.iftar);
    
    const label = document.getElementById('timer-label');
    const timer = document.getElementById('countdown-timer');
    const nextLabel = document.getElementById('next-event-label');
    const nextTime = document.getElementById('next-event-time');
    
    let ms = 0;
    if (now < sTime) { 
      label.textContent = 'рж╕рж╛рж╣рж░рж┐ ржмрж╛ржХрж┐'; 
      ms = sTime - now; 
      nextLabel.textContent = 'рж╕рж╛рж╣рж░рж┐ рж╢рзЗрж╖';
      nextTime.textContent = translateTimeToBengali(todayFast.time.sahur);
    }
    else if (now < iTime) { 
      label.textContent = 'ржЗржлрждрж╛рж░ ржмрж╛ржХрж┐'; 
      ms = iTime - now; 
      nextLabel.textContent = 'ржЗржлрждрж╛рж░ рж╢рзБрж░рзБ';
      nextTime.textContent = translateTimeToBengali(todayFast.time.iftar);
    }
    else { 
      label.textContent = 'ржЗржлрждрж╛рж░ рж╣рзЯрзЗржЫрзЗ'; 
      ms = 0; 
      nextLabel.textContent = 'ржкрж░ржмрж░рзНрждрзА рж╕рж╛рж╣рж░рж┐';
      nextTime.textContent = 'ржЖржЧрж╛ржорзАржХрж╛рж▓';
    }
    const h = Math.floor(ms / 3600000), m = Math.floor((ms % 3600000) / 60000), s = Math.floor((ms % 60000) / 1000);
    timer.textContent = toBengaliDigits(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`);
  };
  tk(); countdownInterval = setInterval(tk, 1000);
}

const setup = async () => {
  let user = null;
  let dbRef = null;
  
  if (typeof __firebase_config !== 'undefined') {
    try {
      const fbConfig = JSON.parse(__firebase_config);
      const fbApp = initializeApp(fbConfig);
      const fbAuth = getAuth(fbApp);
      const fbDb = getFirestore(fbApp);
      await signInAnonymously(fbAuth);
      
      onAuthStateChanged(fbAuth, async (u) => {
        if (u) {
          const snap = await getDoc(doc(fbDb, 'artifacts', appId, 'users', u.uid, 'preferences', 'city'));
          if (snap.exists()) {
            const d = snap.data(); fetchRamadan(d.lat, d.lon, d.cityName);
          } else {
            document.getElementById('loading-overlay').style.display = 'none';
            document.getElementById('splash').style.display = 'flex';
            renderZilaList();
          }
        }
      });
    } catch (e) {
      document.getElementById('loading-overlay').style.display = 'none';
      document.getElementById('splash').style.display = 'flex';
      renderZilaList();
    }
  } else {
    document.getElementById('loading-overlay').style.display = 'none';
    document.getElementById('splash').style.display = 'flex';
    renderZilaList();
  }
};

function renderZilaList(f = "") {
  const el = document.getElementById('zila-list'); el.innerHTML = "";
  districts.filter(d => d.name.includes(f) || d.en.toLowerCase().includes(f.toLowerCase())).forEach(z => {
    const dv = document.createElement('div'); dv.className = "zila-item"; dv.textContent = z.name;
    dv.onclick = async () => {
      if (typeof __firebase_config !== 'undefined') {
        try {
          const auth = getAuth();
          const db = getFirestore();
          await setDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'preferences', 'city'), {lat:z.lat, lon:z.lon, cityName:z.name});
        } catch (e) {}
      }
      fetchRamadan(z.lat, z.lon, z.name);
    };
    el.appendChild(dv);
  });
}

function renderSchedule(data) {
  let html = `<table><thead><tr><th>рж░рзЛржЬрж╛</th><th>рждрж╛рж░рж┐ржЦ</th><th>рж╕рж╛рж╣рж░рж┐</th><th>ржЗржлрждрж╛рж░</th></tr></thead><tbody>`;
  const today = todayDateStr();
  data.fasting.forEach((row, i) => {
    html += `<tr class="${row.date === today ? 'today-row' : ''}">
      <td>${toBengaliDigits(i+1)}</td>
      <td>${toBengaliDigits(new Date(row.date).getDate())}</td>
      <td class="bn-time">${translateTimeToBengali(row.time.sahur)}</td>
      <td class="bn-time">${translateTimeToBengali(row.time.iftar)}</td>
    </tr>`;
  });
  document.getElementById('schedule-container').innerHTML = html + '</tbody></table>';
}

document.getElementById('zila-search').oninput = (e) => renderZilaList(e.target.value);
document.getElementById('gps-btn').onclick = () => {
  navigator.geolocation.getCurrentPosition(async (p) => {
    const lat = p.coords.latitude, lon = p.coords.longitude;
    fetchRamadan(lat, lon, "ржЖржкржирж╛рж░ ржПрж▓рж╛ржХрж╛");
  });
};
document.getElementById('change-location-trigger').onclick = () => {
  document.getElementById('app').style.display = 'none';
  document.getElementById('splash').style.display = 'flex';
  renderZilaList();
};
document.getElementById('btn-hadith').onclick = () => {
  document.getElementById('hadith-view').style.display = 'block';
  document.getElementById('full-schedule-view').style.display = 'none';
  document.getElementById('btn-hadith').classList.add('active');
  document.getElementById('btn-schedule').classList.remove('active');
};
document.getElementById('btn-schedule').onclick = () => {
  document.getElementById('hadith-view').style.display = 'none';
  document.getElementById('full-schedule-view').style.display = 'block';
  document.getElementById('btn-schedule').classList.add('active');
  document.getElementById('btn-hadith').classList.remove('active');
};

setup();
</script>
</body>
</html>